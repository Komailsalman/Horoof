<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>الطلبات</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      width: 300px;
    }
    .card h3 {
      margin-top: 0;
    }
    .item {
      background: #f0f0f0;
      padding: 5px;
      margin-bottom: 5px;
      border-radius: 5px;
    }
    
  </style>
</head>
<body>

<h1>الطلبات المسجلة</h1>
<div class="container" id="ordersContainer"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  // إعداد Firebase
  firebase.initializeApp({
    apiKey: "AIzaSyAd8gOj9NUlYW_alEidKdz6699DWasiPvk",
    authDomain: "horoof-81eb4.firebaseapp.com",
    projectId: "horoof-81eb4"
  });
  const db = firebase.firestore();

  const container = document.getElementById('ordersContainer');

  // دالة لإنشاء بطاقة للطلب
  <!-- داخل ملف HTML (مكان البطاقة داخل الدالة renderOrder) -->

  
  


  function renderOrder(doc) {
  const data = doc.data();
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <h3>طلب رقم ${data.dailyOrderNumber || '-'}</h3>
    <p><small>${new Date(data.time).toLocaleString()}</small></p>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align:right; border: 1px solid #ccc; padding: 8px;">الكمية</th>
          <th style="text-align:right; border: 1px solid #ccc; padding: 8px;">المنتج</th>
        </tr>
      </thead>
      <tbody>
        ${data.items.map((item, index) => {
          // تنظيف الملاحظة من الرموز والأرقام
          let cleanedNote = item.note?.replace(/\(.*?\)/g, '').trim() || '';

          return `
            <tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
              <td style="padding: 8px; text-align: center; border: 1px solid #ccc;">${item.quantity}</td>
              <td style="padding: 8px; border: 1px solid #ccc;">
                ${item.name}
                ${cleanedNote ? `<br><small style="color:gray;">${cleanedNote}</small>` : ''}
              </td>
            </tr>
          `;
        }).join('')}
      </tbody>
    </table>
  `;
  container.prepend(card); // الأحدث فوق
}



  // مراقبة التغيرات مباشرة
  db.collection("kitchenOrders").orderBy("time", "asc")
    .onSnapshot(snapshot => {
      container.innerHTML = ""; // إعادة تحميل كامل
      snapshot.forEach(doc => renderOrder(doc));
    });
</script>

</body>
</html>
