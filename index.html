<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      width: 300px;
      
    }
    .card h3 {
      margin-top: 0;
    }
    .item {
      background: #f0f0f0;
      padding: 5px;
      margin-bottom: 5px;
      border-radius: 5px;
    }

    .fade-out {
  opacity: 0;
  transform: scale(0.95);
  transition: all 0.5s ease;
}


    
  </style>
</head>
<body>

<h1>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h1>
<div class="container" id="ordersContainer"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  firebase.initializeApp({
    apiKey: "AIzaSyAd8gOj9NUlYW_alEidKdz6699DWasiPvk",
    authDomain: "horoof-81eb4.firebaseapp.com",
    projectId: "horoof-81eb4"
  });
  const db = firebase.firestore();

  const container = document.getElementById('ordersContainer');

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø·Ù„Ø¨
  <!-- Ø¯Ø§Ø®Ù„ Ù…Ù„Ù HTML (Ù…ÙƒØ§Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© renderOrder) -->

  
  

  function renderOrder(doc) {
  const data = doc.data();
  const card = document.createElement('div');
  card.className = 'card';

  card.innerHTML = `
  <h3>Ø·Ù„Ø¨ Ø±Ù‚Ù… ${data.dailyOrderNumber || '-'}</h3>
  <p><small>${new Date(data.time).toLocaleString()}</small></p>
  <button class="deliver-btn" style="margin-bottom: 10px; padding: 8px 12px; background-color: #4CAF50; color: white; border: none; cursor: pointer;">ğŸŸ¢ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</button>
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th style="text-align:right; border: 1px solid #ccc; padding: 8px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th style="text-align:right; border: 1px solid #ccc; padding: 8px;">Ø§Ù„Ù…Ù†ØªØ¬</th>
      </tr>
    </thead>
    <tbody>
      ${data.items.map((item, index) => {
        let cleanedNote = item.note?.replace(/\(.*?\)/g, '').trim() || '';
        return `
          <tr class="item-row" style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
            <td style="padding: 8px; text-align: center; border: 1px solid #ccc;">${item.quantity}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              ${item.name}
              ${cleanedNote ? `<br><small style="color:gray;">${cleanedNote}</small>` : ''}
            </td>
          </tr>
        `;
      }).join('')}

      
    </tbody>
  </table>
`;



// Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª ØªØ­Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
const timerDiv = document.createElement('div');
timerDiv.style.marginTop = '10px';
timerDiv.style.fontSize = '14px';
timerDiv.style.fontWeight = 'bold';
timerDiv.style.color = '#555';
card.appendChild(timerDiv);

function updateTimer() {
  const orderTime = new Date(data.time);
  const now = new Date();
  const diffMs = now - orderTime;
  const diffMins = Math.floor(diffMs / 60000);
  const diffSecs = Math.floor((diffMs % 60000) / 1000);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ
  timerDiv.innerText = `Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø© ${diffSecs < 10 ? '0' : ''}${diffSecs} Ø«Ø§Ù†ÙŠØ©`;

  // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¨Ø¹Ø¯ 10 Ø¯Ù‚Ø§Ø¦Ù‚
  if (diffMins >= 10) {
    timerDiv.style.color = 'red';
  } else {
    timerDiv.style.color = '#555'; // ÙŠØ±Ø¬Ø¹ Ù„Ù„ÙˆÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù„Ùˆ Ø£Ù‚Ù„ Ù…Ù† 10 Ø¯Ù‚Ø§ÙŠÙ‚
  }
}

updateTimer();
setInterval(updateTimer, 1000);

  // Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŒ Ø£Ø¶Ù ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¶ØºØ·
  setTimeout(() => {
  const rows = card.querySelectorAll('.item-row');
  rows.forEach((row, index) => {
    row.addEventListener('click', () => {
      if (row.classList.contains('completed')) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¶ØºÙˆØ· Ù…Ø³Ø¨Ù‚Ø§Ù‹ â” Ø±Ø¬Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
        row.style.backgroundColor = (index % 2 === 0) ? '#ffffff' : '#f9f9f9';
        row.classList.remove('completed');
      } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† ØºÙŠØ± Ù…Ø¶ØºÙˆØ· â” Ù„ÙˆÙ†Ù‡ Ø£Ø®Ø¶Ø±
        row.style.backgroundColor = '#88d88a';
        row.classList.add('completed');
      }

      // ØªØ­Ù‚Ù‚ Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¶ØºØ·Ø©
      const allCompleted = [...rows].every(r => r.classList.contains('completed'));
      if (allCompleted) {
      
      
      
      
        if (data) {
  db.collection('DoneOrders').doc(data.orderNumber).set(data)
  .then(async () => {
  console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders:', data.orderNumber);

  // ğŸ‘‡ Ù‡Ù†Ø§ ØªØ³Ø¬Ù„ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¯Ø©
  const deliveredTime = new Date();
  const createdTime = new Date(data.time);
  const diffMs = deliveredTime - createdTime;
  const diffMins = Math.floor(diffMs / 60000);
  const diffSecs = Math.floor((diffMs % 60000) / 1000);

  await db.collection('DoneOrders').doc(data.orderNumber).update({
    deliveredTime: deliveredTime.toISOString(),
    duration: `${diffMins} Ø¯Ù‚ÙŠÙ‚Ø© ${diffSecs < 10 ? '0' : ''}${diffSecs} Ø«Ø§Ù†ÙŠØ©`
  });
  console.log('ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¯Ø© Ù„Ù„Ø·Ù„Ø¨:', data.orderNumber);


  // ğŸ”¥ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  await db.collection('kitchenOrders').doc(data.orderNumber).delete();
  console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders:', data.orderNumber);
  
  // Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„
  card.classList.add('fade-out');
  setTimeout(() => {
    card.remove();
  }, 500);
})

}


        card.classList.add('fade-out');
setTimeout(() => {
  card.remove();
}, 500); // Ù†ÙØ³ Ù…Ø¯Ø© Ø§Ù„ØªØ±Ø§Ù†Ø²ÙŠØ´Ù† Ø¨Ø§Ù„Ø¶Ø¨Ø·

      }
    });
  });
}, 100);






// Ø²Ø± ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ø¹Ø¯Ø§Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ
const deliverBtn = card.querySelector('.deliver-btn');
let countdown = null;
let timer = null;

deliverBtn.addEventListener('click', () => {
  const rows = card.querySelectorAll('.item-row');

  if (timer) {
    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ø¯ ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©
    clearInterval(timer);
    timer = null;
    countdown = null;
    deliverBtn.disabled = false;
    deliverBtn.innerText = 'ğŸŸ¢ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨';

    // Ø±Ø¬Ø¹ Ø§Ù„ØµÙÙˆÙ Ù„Ù„ÙˆÙ†Ù‡Ø§ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
    rows.forEach((row, index) => {
      row.style.backgroundColor = (index % 2 === 0) ? '#ffffff' : '#f9f9f9';
      row.classList.remove('completed');
    });

    console.log('â¹ï¸ ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨');
  } else {
    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
    rows.forEach(row => {
      row.style.backgroundColor = '#88d88a';
      row.classList.add('completed');
    });

    countdown = 3;
    deliverBtn.disabled = false;
    deliverBtn.innerText = `Ø³ÙŠØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ ${countdown}`;

    timer = setInterval(() => {
      countdown--;
      if (countdown > 0) {
        deliverBtn.innerText = `Ø³ÙŠØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ ${countdown}`;
      } else {
        clearInterval(timer);
        timer = null;
        if (data) {
  db.collection('DoneOrders').doc(data.orderNumber).set(data)
  .then(async () => {
  console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders:', data.orderNumber);

  // ğŸ‘‡ Ù‡Ù†Ø§ ØªØ³Ø¬Ù„ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¯Ø©
  const deliveredTime = new Date();
  const createdTime = new Date(data.time);
  const diffMs = deliveredTime - createdTime;
  const diffMins = Math.floor(diffMs / 60000);
  const diffSecs = Math.floor((diffMs % 60000) / 1000);

  await db.collection('DoneOrders').doc(data.orderNumber).update({
    deliveredTime: deliveredTime.toISOString(),
    duration: `${diffMins} Ø¯Ù‚ÙŠÙ‚Ø© ${diffSecs < 10 ? '0' : ''}${diffSecs} Ø«Ø§Ù†ÙŠØ©`
  });
  console.log('ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¯Ø© Ù„Ù„Ø·Ù„Ø¨:', data.orderNumber);

    // ğŸ”¥ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  await db.collection('kitchenOrders').doc(data.orderNumber).delete();
console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† kitchenOrders:', data.orderNumber);

  // Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„
  card.classList.add('fade-out');
  setTimeout(() => {
    card.remove();
  }, 500);
})

}

       card.classList.add('fade-out');
setTimeout(() => {
  card.remove();
}, 500); // Ù†ÙØ³ Ù…Ø¯Ø© Ø§Ù„ØªØ±Ø§Ù†Ø²ÙŠØ´Ù† Ø¨Ø§Ù„Ø¶Ø¨Ø·

      }
    }, 1000);
  }
});







  container.prepend(card);
}


  // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠØ±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
  db.collection("kitchenOrders").orderBy("time", "asc")
    .onSnapshot(snapshot => {
      container.innerHTML = ""; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„
      snapshot.forEach(doc => renderOrder(doc));
    });
</script>

</body>
</html>
